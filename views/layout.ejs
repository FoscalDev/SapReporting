<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - SAP Reports</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=72:ital,wght@0,100;0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/sap-ui5.css" rel="stylesheet">
</head>
<body class="sap-ui5-theme">
    <!-- SAP UI5 Header -->
    <header class="sap-header">
        <div class="sap-header-container">
            <div class="sap-header-left">
                <button class="sap-menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="sap-logo">
                    <i class="fas fa-chart-bar"></i>
                    <span class="sap-logo-text">SAP Reports</span>
                </div>
            </div>
            <div class="sap-header-center">
                <div class="sap-breadcrumb">
                    <span class="sap-breadcrumb-item">SAP Reports</span>
                    <% if (typeof breadcrumb !== 'undefined') { %>
                        <span class="sap-breadcrumb-separator">›</span>
                        <span class="sap-breadcrumb-item"><%= breadcrumb %></span>
                    <% } %>
                </div>
            </div>
            <div class="sap-header-right">
                <div class="sap-header-actions">
                    <button class="sap-button sap-button-icon" title="Estado del Sistema" onclick="checkSystemStatus()">
                        <i class="fas fa-heartbeat"></i>
                    </button>
                    <div class="sap-user-menu">
                        <button class="sap-button sap-button-icon" title="Usuario">
                            <i class="fas fa-user"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- SAP UI5 Layout Container -->
    <div class="sap-layout-container">
        <!-- Side Navigation -->
        <aside class="sap-side-nav" id="sideNav">
            <div class="sap-side-nav-header">
                <h3>Reportes</h3>
            </div>
            <nav class="sap-side-nav-content">
                <div class="sap-nav-section">
                    <div class="sap-nav-section-title">Reportes de Nómina</div>
                    <ul class="sap-nav-list">
                        <li class="sap-nav-item">
                            <a href="/" class="sap-nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'salaries' ? 'active' : '' %>">
                                <i class="fas fa-money-bill-wave sap-nav-icon"></i>
                                <span class="sap-nav-text">Salarios Nómina</span>
                            </a>
                        </li>
                        <li class="sap-nav-item">
                            <a href="/summary/organizational-units" class="sap-nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'summary' ? 'active' : '' %>">
                                <i class="fas fa-building sap-nav-icon"></i>
                                <span class="sap-nav-text">Resumen Organizacional</span>
                            </a>
                        </li>
                        <li class="sap-nav-item">
                            <a href="/search" class="sap-nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'search' ? 'active' : '' %>">
                                <i class="fas fa-search sap-nav-icon"></i>
                                <span class="sap-nav-text">Búsqueda Avanzada</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- Placeholder for future report sections -->
                <div class="sap-nav-section">
                    <div class="sap-nav-section-title">Otros Reportes</div>
                    <ul class="sap-nav-list">
                        <li class="sap-nav-item sap-nav-item-disabled">
                            <span class="sap-nav-link">
                                <i class="fas fa-plus sap-nav-icon"></i>
                                <span class="sap-nav-text">Próximamente...</span>
                            </span>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="sap-main-content" id="mainContent">
            <div class="sap-page-container">
                <% if (typeof error === 'undefined') { %>
                    <%- body %>
                <% } else { %>
                    <div class="sap-error-container">
                        <div class="sap-error-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="sap-error-content">
                            <h2 class="sap-error-title"><%= message %></h2>
                            <p class="sap-error-description"><%= error %></p>
                            <div class="sap-error-actions">
                                <a href="/" class="sap-button sap-button-primary">
                                    <i class="fas fa-home"></i>
                                    Volver al Inicio
                                </a>
                            </div>
                        </div>
                    </div>
                <% } %>
            </div>
        </main>
    </div>

    <!-- Side Navigation Overlay for Mobile -->
    <div class="sap-nav-overlay" id="navOverlay"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // SAP UI5 Theme and Navigation
        document.addEventListener('DOMContentLoaded', function() {
            initializeSAPUI5();
        });

        function initializeSAPUI5() {
            // Menu toggle functionality
            const menuToggle = document.getElementById('menuToggle');
            const sideNav = document.getElementById('sideNav');
            const navOverlay = document.getElementById('navOverlay');
            const mainContent = document.getElementById('mainContent');

            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    sideNav.classList.toggle('sap-side-nav-open');
                    navOverlay.classList.toggle('sap-nav-overlay-show');
                    mainContent.classList.toggle('sap-main-content-collapsed');
                });
            }

            // Close menu when clicking overlay
            if (navOverlay) {
                navOverlay.addEventListener('click', function() {
                    sideNav.classList.remove('sap-side-nav-open');
                    navOverlay.classList.remove('sap-nav-overlay-show');
                    mainContent.classList.remove('sap-main-content-collapsed');
                });
            }

            // Close menu on window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    sideNav.classList.remove('sap-side-nav-open');
                    navOverlay.classList.remove('sap-nav-overlay-show');
                    mainContent.classList.remove('sap-main-content-collapsed');
                }
            });

            // Auto-close menu on mobile after navigation
            const navLinks = document.querySelectorAll('.sap-nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            sideNav.classList.remove('sap-side-nav-open');
                            navOverlay.classList.remove('sap-nav-overlay-show');
                            mainContent.classList.remove('sap-main-content-collapsed');
                        }, 300);
                    }
                });
            });
        }

        // System status check
        async function checkSystemStatus() {
            try {
                const response = await fetch('/status');
                const data = await response.json();
                
                if (data.connected) {
                    showSAPMessage('Sistema conectado correctamente', 'success');
                } else {
                    showSAPMessage('Error de conexión con SAP', 'error');
                }
            } catch (error) {
                showSAPMessage('Error al verificar estado del sistema', 'error');
            }
        }

        // SAP-style message display
        function showSAPMessage(message, type) {
            const messageContainer = document.createElement('div');
            messageContainer.className = `sap-message sap-message-${type}`;
            messageContainer.innerHTML = `
                <div class="sap-message-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(messageContainer);
            
            setTimeout(() => {
                messageContainer.classList.add('sap-message-show');
            }, 100);
            
            setTimeout(() => {
                messageContainer.classList.remove('sap-message-show');
                setTimeout(() => {
                    document.body.removeChild(messageContainer);
                }, 300);
            }, 3000);
        }
        
        // Función para formatear números como moneda
        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        // Función para formatear fechas
        function formatDate(date) {
            if (!date) return 'Sin fecha';
            return new Date(date).toLocaleDateString('es-CO');
        }

        // SAP UI5 Loading indicator
        function showSAPLoading() {
            const loading = document.createElement('div');
            loading.className = 'sap-loading';
            loading.id = 'sapLoading';
            loading.innerHTML = `
                <div class="sap-loading-content">
                    <div class="sap-loading-spinner"></div>
                    <span>Cargando...</span>
                </div>
            `;
            document.body.appendChild(loading);
        }

        function hideSAPLoading() {
            const loading = document.getElementById('sapLoading');
            if (loading) {
                document.body.removeChild(loading);
            }
        }
    </script>
</body>
</html>
